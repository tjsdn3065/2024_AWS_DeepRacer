from math import cos,sin,pi,sqrt,pow,atan2,tan

def reward_function(params):

    # Read input parameters
    x = params['x'] # float. íŠ¸ë™ì´ í¬í•¨ëœ ì‹œë®¬ë ˆì´ì…˜ í™˜ê²½ì—ì„œ xì¶•ê³¼ yì¶•ì— ë”°ë¥¸ agentì˜ ì¤‘ì•™ ìœ„ì¹˜(m)ë¥¼ ë‚˜íƒ€ëƒ„.
    y = params['y']
    track_width = params['track_width'] # float. íŠ¸ë™ì˜ ë„ˆë¹„(m). íŠ¸ë™ì˜ í°ìƒ‰ ê²½ê³„ì„  ì‚¬ì´ ê±°ë¦¬ë¥¼ ì˜ë¯¸
    distance_from_center = params['distance_from_center'] # float. 0~track_width/2. Agentì˜ ì¤‘ì•™ê³¼ íŠ¸ë™ì˜ ì¤‘ì•™ ì‚¬ì´ì˜ ê±°ë¦¬(m). Agentì˜ í•œ ìª½ ë°”í€´ê°€ íŠ¸ë™ì˜ í°ìƒ‰ ê²½ê³„ì„ ì„ ë²—ì–´ë‚¬ì„ ë•Œ ìµœëŒ“ê°’.
    speed = params['speed'] # float. 0.0~4.0. m/s
    steps = params['steps'] # int. ì™„ë£Œí•œ stepì˜ ê°œìˆ˜ë¥¼ ë‚˜íƒ€ëƒ„. stepì€ agentê°€ state ì •ë³´ë¥¼ ì…ë ¥ ë°›ê³  í˜„ì¬ì˜ policyì— ë”°ë¼ ì·¨í•  í•˜ë‚˜ì˜ í–‰ë™ì„ ê²°ì •í•˜ëŠ” ì¼ë ¨ì˜ ê³¼ì • í•œ ë²ˆì„ ì˜ë¯¸. ì°¸ê³ ë¡œ ë”¥ë ˆì´ì„œì—ì„œ ë³´ìƒí•¨ìˆ˜ì— ì ìš©ë˜ëŠ” ì²«ë²ˆì§¸ stepì€ 2ë¶€í„° ì‹œì‘.
    is_offtrack = params['is_offtrack'] # Boolean, Agentê°€ ì¢…ë£Œ ì‹œì ì— íŠ¸ë™ì„ ë²—ì–´ë‚¬ìœ¼ë©´ True, ë²—ì–´ë‚˜ì§€ ì•Šì•˜ìœ¼ë©´ Falseë¥¼ ê°–ëŠ” ë³€ìˆ˜. ì´ ê°’ì´ Trueë©´ í•´ë‹¹ ì—í”¼ì†Œë“œëŠ” ì¢…ë£Œ.
    progress = params['progress'] # float. 0~100. íŠ¸ë™ì„ ì–¼ë§Œí¼ ì£¼í–‰í–ˆëŠ”ì§€ë¥¼ í¼ì„¼íŠ¸ë¡œ ë‚˜íƒ€ëƒ„.
    all_wheels_on_track = params['all_wheels_on_track'] # Boolean. Agentì˜ íŠ¸ë™ ì´íƒˆ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” Booleanê°’. ë°”í€´ê°€ í•˜ë‚˜ë¼ë„ íŠ¸ë™ì˜ í°ìƒ‰ ê²½ê³„ì„ ì„ ë²—ì–´ë‚˜ë©´ False.
    is_left_of_center = params['is_left_of_center'] # Boolean. Agentê°€ íŠ¸ë™ ì¤‘ì•™ì—ì„œ ì™¼ìª½ì— ìˆìœ¼ë©´ True, ì˜¤ë¥¸ìª½ì— ìˆìœ¼ë©´ False.
    waypoints = params['waypoints'] # [[float,float],[float,float],....]. íŠ¸ë™ ì¤‘ì•™ì„ ë”°ë¼ ì •í•´ì§„ waypointì˜ ìœ„ì¹˜ë¥¼ ìˆœì„œëŒ€ë¡œ ë‚˜ì—´í•œ ë¦¬ìŠ¤íŠ¸. ìˆœí™˜ íŠ¸ë™ì˜ ê²½ìš° ì‹œì‘ê³¼ ë ì§€ì ì˜ waypointëŠ” ê°™ìŒ.
    closest_waypoints = params['closest_waypoints'] # [int,int]. Agentì˜ í˜„ì¬ ìœ„ì¹˜ì—ì„œ ê°€ì¥ ê°€ê¹ê²Œ ìœ„ì¹˜í•œ ë‘ waypointì˜ indexë¥¼ ë‚˜íƒ€ëƒ„. Agentì™€ì˜ ìœ í´ë¦¬ë“œ ê±°ë¦¬ ê³„ì‚°ë²•ìœ¼ë¡œ êµ¬í•¨. ì²« ë²ˆì§¸ ê°’ì€ agentì˜ ë’¤ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ waypointë¥¼ ë‚˜íƒ€ë‚´ê³ , ë‘ ë²ˆì§¸ ê°’ì€ agentì˜ ì•ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ waypointë¥¼ ë‚˜íƒ€ëƒ„. ê°€ê¹Œìš´ waypointë¥¼ ì°¾ì„ ë•Œì˜ ê¸°ì¤€ì€ ì•ë°”í€´ ìœ„ì¹˜.
    heading = params['heading'] # float, -180~180. íŠ¸ë™ì˜ xì¶•ì— ëŒ€í•œ agentì˜ ì§„í–‰ ë°©í–¥(ê°ë„)ë¥¼ ë‚˜íƒ€ëƒ„.
    is_reversed = params['is_reversed'] # Boolean. Agentì˜ ë°”í€´ê°€ ì‹œê³„ ë°©í–¥ìœ¼ë¡œ ì£¼í–‰í•˜ë©´ True, ë°˜ì‹œê³„ ë°©í–¥ìœ¼ë¡œ ì£¼í–‰í•˜ë©´ False.

    SPEED_THRESHOLD_straight = 3.0  # ì§ì§„ ì½”ìŠ¤ì—ì„œ ì†ë„ ê¸°ì¤€
    DIRECTION_THRESHOLD = 3.0

    vehicle_length = 0.235
    lfd = 0.6
    is_look_ahead_point = False
    look_ahead_point = None

    optimal_path = [
        (0.546942781193672, 2.646942781193672, 0),
        (0.7213277658761738, 2.2864970997890772, 0),
        (0.9727440448917937, 1.9749178598796095, 0),
        (1.2958513964669303, 1.7384404663923037, 0),
        (1.6633361142279943, 1.5794191718422295, 1),
        (2.048928660610384, 1.4714686318681485, 1),
        (2.4391508896210152, 1.3816787289099692, 1),
        (2.8263986456075902, 1.2797087232376851, 1),
        (3.200713228233672, 1.1377882746012977, 1),
        (3.55342354550835, 0.9480658721038812, 1),
        (3.901138175524185, 0.7493824313356614, 1),
        (4.269643234447392, 0.5928826296080705, 0),
        (4.66676852613121, 0.5446530757720666, 0),
        (5.060134279892209, 0.6211393468360495, 0),
        (5.4278848797949895, 0.7792282161527238, 1),
        (5.76646680324789, 0.9930703224574187, 1),
        (6.0745097632435, 1.2488456670494454, 1),
        (6.351341716251018, 1.538163919442136, 1),
        (6.6006572306238604, 1.851493973086848, 1),
        (6.830371882767349, 2.1794774479351995, 1),
        (7.049690584264791, 2.5145036615198344, 1),
        (7.259673181231572, 2.8554454552824966, 1),
        (7.452239231492758, 3.2065272663115283, 1),
        (7.62102814146515, 3.569620945956636, 1),
        (7.7617415897057995, 3.944531518182296, 1),
        (7.866130285167188, 4.331093255025442, 1),
        (7.913444018896524, 4.72876381341105, 0),
        (7.858225104101608, 5.126006400244746, 0),
        (7.64802895532069, 5.464182280939867, 0),
        (7.314968436163228, 5.688575498890277, 0),
        (6.934858654546222, 5.813740571803263, 0),
        (6.536481730025649, 5.8552952408356305, 0),
        (6.138802076613392, 5.810101738332164, 0),
        (5.759220227761692, 5.682572578765676, 1),
        (5.406227925919514, 5.493532831908302, 1),
        (5.077436319179341, 5.264977871542469, 1),
        (4.764392191041476, 5.0152858551284485, 1),
        (4.453946755105928, 4.762373129508327, 1),
        (4.130828512210158, 4.525821489212927, 1),
        (3.7806711517033693, 4.331500143752449, 1),
        (3.401599148935731, 4.203287026407926, 1),
        (3.007728280279531, 4.130447855710442, 1),
        (2.6099881328543177, 4.084343270277187, 1),
        (2.2120136747242714, 4.040108398454938, 1),
        (1.8172624853713786, 3.972670994490456, 1),
        (1.4348968524634207, 3.8542223042732924, 0),
        (1.0850048237375602, 3.6584763863496415, 0),
        (0.800546369782337, 3.3790129889954623, 0),
        (0.5808430906019764, 3.0399891236094505, 0)
    ]

    if not is_reversed: # ì°¨ëŸ‰ì´ ë°˜ì‹œê³„ ë°©í–¥ìœ¼ë¡œ ì£¼í–‰í•˜ê³  ìˆë‹¤ë©´
        # ğŸ”¹ **ê°€ì¥ ê°€ê¹Œìš´ ìµœì  ê²½ë¡œì  ì°¾ê¸°**
        min_dist = float("inf")
        closest_index = 0

        for i, point in enumerate(optimal_path):
            dist = sqrt((x - point[0]) ** 2 + (y - point[1]) ** 2)
            if dist < min_dist:
                min_dist = dist
                closest_index = i

        # ğŸ”¹ **look-ahead point ì°¾ê¸°**
        for i in range(closest_index, len(optimal_path)):
            point = optimal_path[i]
            dist = sqrt((x - point[0]) ** 2 + (y - point[1]) ** 2)

            if dist > lfd:
                look_ahead_point = point
                is_look_ahead_point = True
                break

    return float(reward)